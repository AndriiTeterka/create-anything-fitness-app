{"dependencies":[{"name":"expo/virtual/env","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dgHc21cgR+buKc7O3/dChhD5JJk=","exportNames":["*"],"imports":1}},{"name":"expo-secure-store","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":49,"index":49}}],"key":"BU2XtfznZ4PiVldqd/oueHCCaLo=","exportNames":["*"],"imports":1}},{"name":"expo/fetch","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":50},"end":{"line":2,"column":48,"index":98}}],"key":"ug2WTu871fxhwUkT+lg+x8TWZJo=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopNamespace(e) {\n    if (e && e.__esModule) return e;\n    var n = {};\n    if (e) Object.keys(e).forEach(function (k) {\n      n[k] = e[k];\n    });\n    n.default = e;\n    return n;\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _expoVirtualEnv = require(_dependencyMap[0], \"expo/virtual/env\");\n  var _expoSecureStore = require(_dependencyMap[1], \"expo-secure-store\");\n  var SecureStore = _interopNamespace(_expoSecureStore);\n  var _expoFetch = require(_dependencyMap[2], \"expo/fetch\");\n  const originalFetch = fetch;\n  const authKey = `${_expoVirtualEnv.env.EXPO_PUBLIC_PROJECT_GROUP_ID}-jwt`;\n  const getURLFromArgs = (...args) => {\n    const [urlArg] = args;\n    let url;\n    if (typeof urlArg === 'string') {\n      url = urlArg;\n    } else if (typeof urlArg === 'object' && urlArg !== null) {\n      url = urlArg.url;\n    } else {\n      url = null;\n    }\n    return url;\n  };\n  const isFirstPartyURL = url => {\n    return url.startsWith('/') || _expoVirtualEnv.env.EXPO_PUBLIC_BASE_URL && url.startsWith(_expoVirtualEnv.env.EXPO_PUBLIC_BASE_URL);\n  };\n  const isSecondPartyURL = url => {\n    return url.startsWith('/_create/');\n  };\n  const fetchToWeb = async function fetchWithHeaders(...args) {\n    const firstPartyURL = _expoVirtualEnv.env.EXPO_PUBLIC_BASE_URL;\n    const secondPartyURL = _expoVirtualEnv.env.EXPO_PUBLIC_PROXY_BASE_URL;\n    if (!firstPartyURL || !secondPartyURL) {\n      return (0, _expoFetch.fetch)(...args);\n    }\n    const [input, init] = args;\n    const url = getURLFromArgs(input, init);\n    if (!url) {\n      return (0, _expoFetch.fetch)(input, init);\n    }\n    const isExternalFetch = !isFirstPartyURL(url);\n    // we should not add headers to requests that don't go to our own server\n    if (isExternalFetch) {\n      return (0, _expoFetch.fetch)(input, init);\n    }\n    let finalInput = input;\n    const baseURL = isSecondPartyURL(url) ? secondPartyURL : firstPartyURL;\n    if (typeof input === 'string') {\n      finalInput = input.startsWith('/') ? `${baseURL}${input}` : input;\n    } else {\n      return originalFetch(input, init);\n    }\n    const initHeaders = init?.headers ?? {};\n    const finalHeaders = new Headers(initHeaders);\n    const headers = {\n      'x-createxyz-project-group-id': _expoVirtualEnv.env.EXPO_PUBLIC_PROJECT_GROUP_ID,\n      host: _expoVirtualEnv.env.EXPO_PUBLIC_HOST,\n      'x-forwarded-host': _expoVirtualEnv.env.EXPO_PUBLIC_HOST,\n      'x-createxyz-host': _expoVirtualEnv.env.EXPO_PUBLIC_HOST\n    };\n    for (const [key, value] of Object.entries(headers)) {\n      if (value) {\n        finalHeaders.set(key, value);\n      }\n    }\n    const auth = await SecureStore.getItemAsync(authKey).then(auth => {\n      return auth ? JSON.parse(auth) : null;\n    }).catch(() => {\n      return null;\n    });\n    if (auth) {\n      finalHeaders.set('authorization', `Bearer ${auth.jwt}`);\n    }\n    return (0, _expoFetch.fetch)(finalInput, {\n      ...init,\n      headers: finalHeaders\n    });\n  };\n  var _default = fetchToWeb;\n});","lineCount":96,"map":[[16,2,92,0,"Object"],[16,8,92,0],[16,9,92,0,"defineProperty"],[16,23,92,0],[16,24,92,0,"exports"],[16,31,92,0],[17,4,92,0,"enumerable"],[17,14,92,0],[18,4,92,0,"get"],[18,7,92,0],[18,18,92,0,"get"],[18,19,92,0],[19,6,92,0],[19,13,92,0,"_default"],[19,21,92,0],[20,4,92,0],[21,2,92,0],[22,2,92,26],[22,6,92,26,"_expoVirtualEnv"],[22,21,92,26],[22,24,92,26,"require"],[22,31,92,26],[22,32,92,26,"_dependencyMap"],[22,46,92,26],[23,2,1,0],[23,6,1,0,"_expoSecureStore"],[23,22,1,0],[23,25,1,0,"require"],[23,32,1,0],[23,33,1,0,"_dependencyMap"],[23,47,1,0],[24,2,1,0],[24,6,1,0,"SecureStore"],[24,17,1,0],[24,20,1,0,"_interopNamespace"],[24,37,1,0],[24,38,1,0,"_expoSecureStore"],[24,54,1,0],[25,2,2,0],[25,6,2,0,"_expoFetch"],[25,16,2,0],[25,19,2,0,"require"],[25,26,2,0],[25,27,2,0,"_dependencyMap"],[25,41,2,0],[26,2,4,0],[26,8,4,6,"originalFetch"],[26,21,4,19],[26,24,4,22,"fetch"],[26,29,4,27],[27,2,5,0],[27,8,5,6,"authKey"],[27,15,5,13],[27,18,5,16],[27,21,5,16,"_expoVirtualEnv"],[27,36,5,16],[27,37,5,16,"env"],[27,40,5,16],[27,41,5,16,"EXPO_PUBLIC_PROJECT_GROUP_ID"],[27,69,5,16],[27,75,5,65],[28,2,7,0],[28,8,7,6,"getURLFromArgs"],[28,22,7,20],[28,25,7,23,"getURLFromArgs"],[28,26,7,24],[28,29,7,27,"args"],[28,33,7,57],[28,38,7,62],[29,4,8,2],[29,10,8,8],[29,11,8,9,"urlArg"],[29,17,8,15],[29,18,8,16],[29,21,8,19,"args"],[29,25,8,23],[30,4,9,2],[30,8,9,6,"url"],[30,11,9,24],[31,4,10,2],[31,8,10,6],[31,15,10,13,"urlArg"],[31,21,10,19],[31,26,10,24],[31,34,10,32],[31,36,10,34],[32,6,11,4,"url"],[32,9,11,7],[32,12,11,10,"urlArg"],[32,18,11,16],[33,4,12,2],[33,5,12,3],[33,11,12,9],[33,15,12,13],[33,22,12,20,"urlArg"],[33,28,12,26],[33,33,12,31],[33,41,12,39],[33,45,12,43,"urlArg"],[33,51,12,49],[33,56,12,54],[33,60,12,58],[33,62,12,60],[34,6,13,4,"url"],[34,9,13,7],[34,12,13,10,"urlArg"],[34,18,13,16],[34,19,13,17,"url"],[34,22,13,20],[35,4,14,2],[35,5,14,3],[35,11,14,9],[36,6,15,4,"url"],[36,9,15,7],[36,12,15,10],[36,16,15,14],[37,4,16,2],[38,4,17,2],[38,11,17,9,"url"],[38,14,17,12],[39,2,18,0],[39,3,18,1],[40,2,20,0],[40,8,20,6,"isFirstPartyURL"],[40,23,20,21],[40,26,20,25,"url"],[40,29,20,36],[40,33,20,41],[41,4,21,2],[41,11,22,4,"url"],[41,14,22,7],[41,15,22,8,"startsWith"],[41,25,22,18],[41,26,22,19],[41,29,22,22],[41,30,22,23],[41,34,23,5,"_expoVirtualEnv"],[41,49,23,5],[41,50,23,5,"env"],[41,53,23,5],[41,54,23,5,"EXPO_PUBLIC_BASE_URL"],[41,74,23,5],[41,78,23,41,"url"],[41,81,23,44],[41,82,23,45,"startsWith"],[41,92,23,55],[41,93,23,55,"_expoVirtualEnv"],[41,108,23,55],[41,109,23,55,"env"],[41,112,23,55],[41,113,23,55,"EXPO_PUBLIC_BASE_URL"],[41,133,23,88],[41,134,23,90],[42,2,25,0],[42,3,25,1],[43,2,27,0],[43,8,27,6,"isSecondPartyURL"],[43,24,27,22],[43,27,27,26,"url"],[43,30,27,37],[43,34,27,42],[44,4,28,2],[44,11,28,9,"url"],[44,14,28,12],[44,15,28,13,"startsWith"],[44,25,28,23],[44,26,28,24],[44,37,28,35],[44,38,28,36],[45,2,29,0],[45,3,29,1],[46,2,32,0],[46,8,32,6,"fetchToWeb"],[46,18,32,16],[46,21,32,19],[46,36,32,34,"fetchWithHeaders"],[46,52,32,50,"fetchWithHeaders"],[46,53,32,51],[46,56,32,54,"args"],[46,60,32,66],[46,62,32,68],[47,4,33,2],[47,10,33,8,"firstPartyURL"],[47,23,33,21],[47,26,33,21,"_expoVirtualEnv"],[47,41,33,21],[47,42,33,21,"env"],[47,45,33,21],[47,46,33,21,"EXPO_PUBLIC_BASE_URL"],[47,66,33,56],[48,4,34,2],[48,10,34,8,"secondPartyURL"],[48,24,34,22],[48,27,34,22,"_expoVirtualEnv"],[48,42,34,22],[48,43,34,22,"env"],[48,46,34,22],[48,47,34,22,"EXPO_PUBLIC_PROXY_BASE_URL"],[48,73,34,63],[49,4,35,2],[49,8,35,6],[49,9,35,7,"firstPartyURL"],[49,22,35,20],[49,26,35,24],[49,27,35,25,"secondPartyURL"],[49,41,35,39],[49,43,35,41],[50,6,36,4],[50,13,36,11],[50,17,36,11,"expoFetch"],[50,27,36,20],[50,28,36,20,"fetch"],[50,33,36,20],[50,35,36,21],[50,38,36,24,"args"],[50,42,36,28],[50,43,36,29],[51,4,37,2],[52,4,38,2],[52,10,38,8],[52,11,38,9,"input"],[52,16,38,14],[52,18,38,16,"init"],[52,22,38,20],[52,23,38,21],[52,26,38,24,"args"],[52,30,38,28],[53,4,39,2],[53,10,39,8,"url"],[53,13,39,11],[53,16,39,14,"getURLFromArgs"],[53,30,39,28],[53,31,39,29,"input"],[53,36,39,34],[53,38,39,36,"init"],[53,42,39,40],[53,43,39,41],[54,4,40,2],[54,8,40,6],[54,9,40,7,"url"],[54,12,40,10],[54,14,40,12],[55,6,41,4],[55,13,41,11],[55,17,41,11,"expoFetch"],[55,27,41,20],[55,28,41,20,"fetch"],[55,33,41,20],[55,35,41,21,"input"],[55,40,41,26],[55,42,41,28,"init"],[55,46,41,32],[55,47,41,33],[56,4,42,2],[57,4,44,2],[57,10,44,8,"isExternalFetch"],[57,25,44,23],[57,28,44,26],[57,29,44,27,"isFirstPartyURL"],[57,44,44,42],[57,45,44,43,"url"],[57,48,44,46],[57,49,44,47],[58,4,45,2],[59,4,46,2],[59,8,46,6,"isExternalFetch"],[59,23,46,21],[59,25,46,23],[60,6,47,4],[60,13,47,11],[60,17,47,11,"expoFetch"],[60,27,47,20],[60,28,47,20,"fetch"],[60,33,47,20],[60,35,47,21,"input"],[60,40,47,26],[60,42,47,28,"init"],[60,46,47,32],[60,47,47,33],[61,4,48,2],[62,4,50,2],[62,8,50,6,"finalInput"],[62,18,50,16],[62,21,50,19,"input"],[62,26,50,24],[63,4,51,2],[63,10,51,8,"baseURL"],[63,17,51,15],[63,20,51,18,"isSecondPartyURL"],[63,36,51,34],[63,37,51,35,"url"],[63,40,51,38],[63,41,51,39],[63,44,51,42,"secondPartyURL"],[63,58,51,56],[63,61,51,59,"firstPartyURL"],[63,74,51,72],[64,4,52,2],[64,8,52,6],[64,15,52,13,"input"],[64,20,52,18],[64,25,52,23],[64,33,52,31],[64,35,52,33],[65,6,53,4,"finalInput"],[65,16,53,14],[65,19,53,17,"input"],[65,24,53,22],[65,25,53,23,"startsWith"],[65,35,53,33],[65,36,53,34],[65,39,53,37],[65,40,53,38],[65,43,53,41],[65,46,53,44,"baseURL"],[65,53,53,51],[65,56,53,54,"input"],[65,61,53,59],[65,63,53,61],[65,66,53,64,"input"],[65,71,53,69],[66,4,54,2],[66,5,54,3],[66,11,54,9],[67,6,55,4],[67,13,55,11,"originalFetch"],[67,26,55,24],[67,27,55,25,"input"],[67,32,55,30],[67,34,55,32,"init"],[67,38,55,36],[67,39,55,37],[68,4,56,2],[69,4,58,2],[69,10,58,8,"initHeaders"],[69,21,58,19],[69,24,58,22,"init"],[69,28,58,26],[69,30,58,28,"headers"],[69,37,58,35],[69,41,58,39],[69,42,58,40],[69,43,58,41],[70,4,59,2],[70,10,59,8,"finalHeaders"],[70,22,59,20],[70,25,59,23],[70,29,59,27,"Headers"],[70,36,59,34],[70,37,59,35,"initHeaders"],[70,48,59,46],[70,49,59,47],[71,4,61,2],[71,10,61,8,"headers"],[71,17,61,15],[71,20,61,18],[72,6,62,4],[72,36,62,34],[72,38,62,34,"_expoVirtualEnv"],[72,53,62,34],[72,54,62,34,"env"],[72,57,62,34],[72,58,62,34,"EXPO_PUBLIC_PROJECT_GROUP_ID"],[72,86,62,76],[73,6,63,4,"host"],[73,10,63,8],[73,12,63,8,"_expoVirtualEnv"],[73,27,63,8],[73,28,63,8,"env"],[73,31,63,8],[73,32,63,8,"EXPO_PUBLIC_HOST"],[73,48,63,38],[74,6,64,4],[74,24,64,22],[74,26,64,22,"_expoVirtualEnv"],[74,41,64,22],[74,42,64,22,"env"],[74,45,64,22],[74,46,64,22,"EXPO_PUBLIC_HOST"],[74,62,64,52],[75,6,65,4],[75,24,65,22],[75,26,65,22,"_expoVirtualEnv"],[75,41,65,22],[75,42,65,22,"env"],[75,45,65,22],[75,46,65,22,"EXPO_PUBLIC_HOST"],[76,4,66,2],[76,5,66,3],[77,4,68,2],[77,9,68,7],[77,15,68,13],[77,16,68,14,"key"],[77,19,68,17],[77,21,68,19,"value"],[77,26,68,24],[77,27,68,25],[77,31,68,29,"Object"],[77,37,68,35],[77,38,68,36,"entries"],[77,45,68,43],[77,46,68,44,"headers"],[77,53,68,51],[77,54,68,52],[77,56,68,54],[78,6,69,4],[78,10,69,8,"value"],[78,15,69,13],[78,17,69,15],[79,8,70,6,"finalHeaders"],[79,20,70,18],[79,21,70,19,"set"],[79,24,70,22],[79,25,70,23,"key"],[79,28,70,26],[79,30,70,28,"value"],[79,35,70,33],[79,36,70,34],[80,6,71,4],[81,4,72,2],[82,4,74,2],[82,10,74,8,"auth"],[82,14,74,12],[82,17,74,15],[82,23,74,21,"SecureStore"],[82,34,74,32],[82,35,74,33,"getItemAsync"],[82,47,74,45],[82,48,74,46,"authKey"],[82,55,74,53],[82,56,74,54],[82,57,75,5,"then"],[82,61,75,9],[82,62,75,11,"auth"],[82,66,75,15],[82,70,75,20],[83,6,76,6],[83,13,76,13,"auth"],[83,17,76,17],[83,20,76,20,"JSON"],[83,24,76,24],[83,25,76,25,"parse"],[83,30,76,30],[83,31,76,31,"auth"],[83,35,76,35],[83,36,76,36],[83,39,76,39],[83,43,76,43],[84,4,77,4],[84,5,77,5],[84,6,77,6],[84,7,78,5,"catch"],[84,12,78,10],[84,13,78,11],[84,19,78,17],[85,6,79,6],[85,13,79,13],[85,17,79,17],[86,4,80,4],[86,5,80,5],[86,6,80,6],[87,4,82,2],[87,8,82,6,"auth"],[87,12,82,10],[87,14,82,12],[88,6,83,4,"finalHeaders"],[88,18,83,16],[88,19,83,17,"set"],[88,22,83,20],[88,23,83,21],[88,38,83,36],[88,40,83,38],[88,50,83,48,"auth"],[88,54,83,52],[88,55,83,53,"jwt"],[88,58,83,56],[88,60,83,58],[88,61,83,59],[89,4,84,2],[90,4,86,2],[90,11,86,9],[90,15,86,9,"expoFetch"],[90,25,86,18],[90,26,86,18,"fetch"],[90,31,86,18],[90,33,86,19,"finalInput"],[90,43,86,29],[90,45,86,31],[91,6,87,4],[91,9,87,7,"init"],[91,13,87,11],[92,6,88,4,"headers"],[92,13,88,11],[92,15,88,13,"finalHeaders"],[93,4,89,2],[93,5,89,3],[93,6,89,4],[94,2,90,0],[94,3,90,1],[95,2,92,0],[95,6,92,0,"_default"],[95,14,92,0],[95,17,92,15,"fetchToWeb"],[95,27,92,25],[96,0,92,26],[96,3]],"functionMap":{"names":["<global>","getURLFromArgs","isFirstPartyURL","isSecondPartyURL","fetchWithHeaders","SecureStore.getItemAsync.then$argument_0","SecureStore.getItemAsync.then._catch$argument_0"],"mappings":"AAA;uBCM;CDW;wBEE;CFK;yBGE;CHE;mBIG;UC2C;KDE;WEC;KFE;CJU"},"hasCjsExports":false},"type":"js/module"}]}